---
title: "index"
author: "Julia Mason"
date: "11/30/2017"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library (tidyverse)
library (beyonce)

```

## MPG dataset

Use data() to view available R datasets. Use ?mpg to read more about the specific dataset/metadata. 

Use backticks around words to put them in "code font" E.g. `geom_scatter`

### Scatterplot
```{r mpg}
# mpg

g <- ggplot (data = mpg,
             aes (x = displ, y = hwy)) 
g + geom_point()

```

#### Color! Going DEEPER INTO HEADINGS
```{r color scatter}
g + geom_point (aes (color = class))
```

#### Use shape for a b&w figure
Changed `color` to `shape`

```{r b&w}
g + geom_point (aes (shape = class))
```
```{r color and size}
g + geom_point (aes (color = fl, size = class))
```
#### 5.5 Exercises:
Scatter hwy vs cty, size represents class and color represents fuel type

```{r scatter exercise}
ggplot (mpg, aes (x = cty, y = hwy, size = class, col = fl)) +
  geom_point()
```

1: color = "blue" should be outside of aesthetic. 
```{r 5.5 1}

ggplot(data = mpg) + 
      geom_point(aes(x = displ, y = hwy, color = "blue")) +
  ggtitle ("Wrong")

ggplot(data = mpg) + 
      geom_point(aes(x = displ, y = hwy), color = "blue") +
  ggtitle ("Right")
```


2: plot hw vs disply, color indicates city
```{r 5.5 2}
ggplot (mpg, aes (x = displ, y = hwy, col = cty)) +
  geom_point()
```
3: now use shape for cty. Doesn't work bc cty is a continuous variable--can't have a shape mapping. 
```{r 5.5 3, eval = FALSE}
ggplot (mpg, aes (x = displ, y = hwy, shape = cty)) +
  geom_point()
```

4: map aesthetic to something other than variable, e.g displ < 5. Yields two colors reflecting true/false
```{r 5.5 4}

ggplot (mpg, aes (x = displ, y = hwy, col = displ < 5)) +
  geom_point()

```

## Geoms

```{r geom_examples}

ggplot (mpg, aes (x = drv, y = hwy)) +
  geom_jitter()

ggplot (mpg, aes (x = drv, y = hwy)) +
  geom_violin()


```

## Geoms on geoms
```{r geomception}

ggplot (mpg, aes (x = displ, y = hwy)) +
  geom_point () +
  geom_smooth ()

```
## Customize
```{r customize}
ggplot (mpg, aes (x = displ, y = hwy)) +
  geom_point () +
  geom_smooth () +
  labs (title = "Rltp btw engine size and hwy mpg",
       x = "Engine displacement (l)", 
       y = "Hwy mpg") +
  theme_minimal () +
  theme (text = element_text(size = 16))
```

### A CHALLENGE (5.9)
Create a beautiful graph
```{r beautify challenge}


ggplot (mpg, aes (x = class, y = hwy, fill = class)) +
  geom_violin(size = 0) + # removes outline
  theme_bw() +
  scale_fill_manual (values = beyonce_palette(74)) +
  labs (fill = "Car type") +
  theme (axis.text = element_text (angle = 45, hjust = 1))
  

```

# Data Wrangling with `dplyr`
```{r dplyr}
# read in RAW data from OHI github--raw button on top right
gapminder <- read_csv("https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/gapminder.csv")

### useful functions to get to know your data
head (gapminder)
tail (gapminder)

str (gapminder)

names (gapminder)

dim (gapminder)

summary (gapminder)

# select columns with $
## hot tip! command + l or r arrow jumps from front to back of line. option + l or r arrow jumps between words, operators, etc. Holding down shift while you do that highlights as you go. 
head( gapminder$lifeExp)
```

### Dplyr functions

#### Filter
```{r filter}
filter (gapminder, lifeExp < 29)
filter(gapminder, country == "Mexico")

filter (gapminder, country == "Mexico", year == 2002)

# challenge: what is the mean life expectancy of sweden? Do in 2 variables.
sweden <- filter (gapminder, country == "Sweden")
mn.sweden <- mean (sweden$lifeExp)

```
## Pipe operator 
shortcut: cmd + shift + m 
indenting code: select and then cmd + i
```{r pipe}
gapminder %>% head

gapminder %>% 
  filter (country == "Sweden") %>% 
  summarise (mn = mean (lifeExp))


```

## select by columns
```{r select}
select (gapminder, year, lifeExp)

gapminder %>%
  select (year, lifeExp) %>%
  tail


## combine it!

gapminder %>%
  filter (country == "Cambodia") %>%
  select (1, 2, 5)

gapminder %>% 
  select (-continent, -lifeExp)
```
## `mutate()` to add columns

Add new column, gdp. Population * gdp per cap
```{r mutate}

gapminder %>%
  mutate (gdp = pop * gdpPercap,
          index = 1:nrow(gapminder))


```
### Exercise: find max gdp per capita for egypt and vietnam, create new column
```{r gapminder pipe exercise}

gapminder %>%
  filter (country %in% c("Egypt", "Vietnam")) %>%
  # group_by (country) %>%
  mutate (max_gdp = max (gdpPercap))

# gapminder %>% filter (country == c("Egypt", "Vietnam"))

# group_by
gapminder %>%
  # filter (country %in% c("Egypt", "Vietnam")) %>%
  group_by (country) %>%
  summarise (max_gdp = max (gdpPercap), min_gdp = min (gdpPercap), count = n(), mean_lifeExp = mean (lifeExp))

# keep year associated with max_gdp
gapminder %>%
  
  group_by (country) %>%
  mutate (max_gdpPercap = max (gdpPercap)) %>%
  filter (gdpPercap == max_gdpPercap) 

# OR

gapminder %>%
 
  group_by (country) %>%
  #mutate (max_gdpPercap = max (gdpPercap)) %>%
  filter (gdpPercap == max(gdpPercap) )

# OR

gapminder %>%
  # filter (country %in% c("Egypt", "Vietnam")) %>%
  group_by (country) %>%
  # mutate (max_gdpPercap = max (gdpPercap)) %>%
  # filter (gdpPercap == max(gdpPercap) )
  summarise (max_gpc = max (gdpPercap), year = gapminder$year[which (gapminder$gdpPercap == max_gpc)]) %>%
  arrange (desc (max_gpc, desc))

```
## joins
```{r joins}
## read in data from OHI book
co2 <- read_csv("https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/co2.csv")
# this is just for 2007

# create new gapminder variable with just 2007 data
gap_2007 <- gapminder %>% 
  filter (year == 2007) %>%
  left_join (co2, by = "country")

gap_2007 %>% dim()
# gap_2007 %>% View() # can't have this in knitted document

# right join gapminder to co2 (only countries beginning with A)
gap_2007_rj <- gapminder %>% 
  filter (year == 2007) %>%
  right_join (co2)

```
